<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V5.0//EN"
"http://docbook.org/xml/5.0/dtd/docbook.dtd">
<section xml:id="reference.phases" xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Port Phases</title>

  <section xml:id="reference.phases.introduction">
    <title>Introduction</title>

    <para>The MacPorts port installation process has a number of distinct
    phases that are described in detail in this section. The default scripts
    coded into MacPorts base performs the standard
    <command>configure</command>, <command>make</command>, and <command>make
    install</command> steps. For applications that do not conform to this
    standard, installation phases may be declared in a Portfile to <link
    linkend="development.examples.augment">augment</link> or <link
    linkend="development.examples.override">override</link> the default
    behavior as described in the <link linkend="development">Portfile
    Development</link> chapter.</para>

    <variablelist>
      <varlistentry>
        <term>fetch</term>

        <listitem>
          <para>Fetch the <varname>${distfiles}</varname> from
          <varname>${master_sites}</varname> and place it in
          <filename>${prefix}/var/macports/distfiles/${name}</filename>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>checksum</term>

        <listitem>
          <para>Compare <varname>${checksums}</varname> specified in a
          <filename>Portfile</filename> to the checksums of the fetched
          ${distfiles}.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>extract</term>

        <listitem>
          <para>Unzip and untar the <varname>${distfiles}</varname> into the
          path ${prefix}/var/macports/build/..../work</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patch</term>

        <listitem>
          <para>Apply optional <link
          xlink:href="https://en.wikipedia.org/wiki/Patch_(Unix)">patch</link> files
          specified in <varname>${patchfiles}</varname> to modify a port's
          source code file(s).</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure</term>

        <listitem>
          <para>Execute <varname>${configure.cmd}</varname> in
          <varname>${worksrcpath}</varname>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build</term>

        <listitem>
          <para>Execute <varname>${build.cmd}</varname> in
          <varname>${worksrcpath}</varname>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>test</term>

        <listitem>
          <para>Execute commands to run test suites bundled with a
          port, available only for a fraction of ports.
	  This is an optional phase, run only if <command>port test</command> is executed,
	  and always works with a build from source, not a binary. A failure is only for the user's
	  information, and does not block a subsequent installation from the build.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot</term>

        <listitem>
          <para>Execute the command <command>make install</command>
          <varname>DESTDIR=${destroot}</varname>in
          <varname>${worksrcpath}</varname>.</para>

          <note>
            <para>Using a <link
            xlink:href="https://www.gnu.org/prep/standards/html_node/DESTDIR.html"><varname>DESTDIR</varname>
            variable</link> is a part of standard GNU coding practices, and
            this variable must be supported in an application's install
            routines for MacPorts' destroot phase to work without manual
            Portfile scripting or source patching. Urge developers to fully
            support <varname>DESTDIR</varname> in their applications.</para>
          </note>

          <para>Understanding the destroot phase is critical to understanding
          MacPorts, because, unlike some package management systems, MacPorts
          <quote>stages</quote> an installation into an intermediate location,
          not the final file destination. MacPorts uses the destroot phase to
          provide:</para>

          <itemizedlist>
            <listitem>
              <para>Port uninstalls - a port's files may be cleanly
              uninstalled because all files and directories are recorded
              during install.</para>
            </listitem>

            <listitem>
              <para>Multiple port versions may be installed on the same host,
              since a port's files are not directly inserted into
              <varname>${prefix}</varname> but rather hard-linked into
              <varname>${prefix}</varname> from an intermediate location
              during a later activation phase.</para>
            </listitem>
          </itemizedlist>

          <para>Any empty directories in <varname>${destroot}</varname> upon
          completion of the destroot phase are removed unless a directory name
          is placed in the value field of the optional
          <code>destroot.keepdirs</code> keyword.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>install</term>

        <listitem>
          <para>Archive a port's destrooted files into
          <filename>${prefix}/var/macports/software</filename>. See <link
          linkend="internals.images">Port Images</link> in the <link
          linkend="internals">MacPorts Internals</link> chapter for
          details.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>activate</term>

        <listitem>
          <para>Extract the port's files from the archive in
          <filename>${prefix}/var/macports/software</filename> to
          their final installed locations, usually inside
          <varname>${prefix}</varname>.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section xml:id="reference.phases.installation">
    <title>Installation Phase Keywords</title>

    <para>MacPorts keywords are used to specify required or optional items
    within a Portfile, or to override default options used by MacPorts base
    for individual ports. Keywords are to be used within the
    <quote>global</quote> and <quote>variant</quote> sections of Portfiles,
    and not within optional port phase declarations.</para>

    <para>In other words, port phase keywords are not located within port
    phase declarations, but rather they <emphasis>refer</emphasis> to port
    phases and set options for those phases, and they take effect whether or
    not phase declarations have been explicitly defined in a Portfile.</para>

    <section xml:id="reference.phases.installation.list-modifiers">
      <title>Keyword List Modifiers (-append, -delete, -replace, -strsed)</title>

      <para>Keyword list modifiers are keywords that end in -append, -delete or
      -replace. Keywords that support list modifiers are identified under
      appropriate reference sections below.</para>

      <para>-append adds a value to the keyword, -delete removes a previously
      added item. -replace takes two arguments and replaces the first value
      from the keyword with the second value. -strsed treats the keyword value
      as a string and filters it through
      <link linkend="reference.tcl-extensions.strsed">strsed</link> using the
      given pattern. There is also a deprecated syntax for -replace which takes
      only one argument and behaves the same as -strsed.</para>

      <para>Keyword list modifiers are most frequently used for these three
      purposes:</para>

      <orderedlist>
        <listitem>
          <para>Preserve configure defaults set by a previously executed
          Portfile keyword or by MacPorts base</para>

          <para>MacPorts base sets the gcc compiler flags CFLAGS and LDFLAGS
          for all ports using <literal>configure.cflags</literal> and
          <literal>configure.ldflags</literal>, therefore to keep from
          overwriting the default compiler flags use
          <literal>configure.cflags-append</literal> and
          <literal>configure.ldflags-append</literal>.</para>

          <itemizedlist>
            <listitem>
              <para><code>configure.cflags-append</code></para>
            </listitem>

            <listitem>
              <para><code>configure.ldflags-append</code></para>
            </listitem>
          </itemizedlist>
        </listitem>

        <listitem>
          <para>Preserve PortGroup Dependencies</para>

          <para>Ports in a PortGroup have default library dependencies set by
          MacPorts base. Therefore, never use <literal>depends_lib</literal>
          in ports belonging to a PortGroup or it will overwrite the default
          library dependencies. Instead, use
          <literal>depends_lib-append</literal>.</para>
        </listitem>

        <listitem>
          <para>Add or Delete Items for Variants</para>

          <para>When a variant requires more or fewer dependencies, distfiles,
          or patchfiles, when the variant is invoked you want to add or remove
          items to the appropriate keyword values list set in the global
          section of the Portfile. Use the appropriate keywords, for
          example:</para>

          <itemizedlist>
            <listitem>
              <para><code>depends_lib-append</code> or
              <code>depends_lib-delete</code> or
              <code>depends_lib-replace</code>
              </para>
            </listitem>

            <listitem>
              <para><code>distfiles-append</code> or
              <code>distfiles-delete</code> or
              <code>distfiles-replace</code></para>
            </listitem>

            <listitem>
              <para><code>patchfiles-append</code> or
              <code>patchfiles-delete</code> or
              <code>patchfiles-replace</code></para>
            </listitem>
          </itemizedlist>
        </listitem>
      </orderedlist>
    </section>

    <section xml:id="reference.phases.installation.argument-modifiers">
      <title>Keyword Argument Modifiers (.pre_args / .post_args)</title>

      <para>Keywords that support pre_args and post_args are used to assemble
      command strings together in a row, as described in the reference
      sections below. But it should be noted that all keyword argument
      modifiers implicitly support keyword list modifiers. For example, the
      keyword <literal>configure.pre_args</literal> also supports
      <literal>configure.pre_args-append</literal> and
      <literal>configure.pre_args-delete</literal>.</para>
    </section>
  </section>

  <section xml:id="reference.phases.fetch">
    <title>Fetch Phase Keywords</title>

    <para>The list of keywords related to the fetch phase.</para>

    <variablelist>
      <varlistentry>
        <term>master_sites</term>

        <listitem>
          <para>A list of URLs from which a port's
          <varname>${distfiles}</varname> may be retrieved.</para>

          <para>Keyword values for <code>master_sites</code> may include
          predefined site lists known as <quote>mirrors</quote>, such as
          sourceforge, gnu, etc. The file(s) declared in <varname>${distfiles}</varname>
          will be fetched from one of the locations defined in
          <code>master_sites</code>, while trying to find the best reachable
          mirror for the user's connection.</para>

          <para>For a complete list of mirrors and their list of sites, see
          the file <filename>mirror_sites.tcl</filename> located in
          <filename>_resources/port1.0/fetch/</filename> in the ports tree.</para>

          <note>
            <para>If a <code>master_sites</code> keyword has multiple values,
            after any mirrors are expanded the list of sites is sorted by ping
            response times. The sites are then tried in sorted order until
            matching <varname>${distfiles}</varname> are found.</para>
          </note>

          <itemizedlist>
            <listitem>
              <para>Default: <code>none</code> (but the <code>macports_distfiles</code>
              mirror is always implicitly appended)</para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>master_sites        https://www.example.org/files/ \
                    https://mirror.example.org/example_org/files/

</programlisting>

              <para>You may also use mirror site lists predefined by MacPorts.
              Here the sourceforge, gnu, and freebsd mirrors are
              used.</para>

              <programlisting>master_sites        sourceforge gnu freebsd

</programlisting>

              <para>When using mirror master_sites, the subdirectory
              <varname>${name}</varname> is checked on every mirror. If the
              mirror subdirectory does not match ${name}, then you may specify
              it using after the mirror separated by a colon.</para>

              <programlisting>master_sites        sourceforge:widget \
                    gnu:widget

</programlisting>

              <para>For ports that must fetch multiple download files from
              different locations, you must label the files with tags and
              match the tags to a <literal>distfiles</literal> keyword. The
              format is <literal>mirror:subdirectory:tag</literal>.</para>

              <para>In the example below, file_one.tar.gz is fetched from
              sourceforge mirrors in subdirectory <varname>${name}</varname>;
              file tagtwo.tar.gz is fetched from the gnu mirrors in
              subdirectory sources.</para>

              <programlisting>master_sites        sourceforge::tagone \
                    gnu:sources:tagtwo

distfiles           file_one.tar.gz:tagone \
                    file_two.tar.gz:tagtwo</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>master_sites.mirror_subdir</term>

        <listitem>
          <para>Subdirectory to append to all mirror sites for any list
          specified in <varname>${master_sites}</varname>.</para>

          <!-- TODO: add a better explanation -->

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${name}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>master_sites.mirror_subdir  magic</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patch_sites</term>

        <listitem>
          <para>A list of sites from which a port's patchfiles may be
          downloaded, where applicable.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${master_sites}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patch_sites         ftp://ftp.patchcityrepo.com/pub/magic/patches</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patch_sites.mirror_subdir</term>

        <listitem>
          <para>Subdirectory to append to all mirror sites for any list
          specified in <varname>${patch_sites}</varname>.</para>

          <!-- TODO: add a better explanation -->

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${name}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patch_sites.mirror_subdir   magic</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>distname</term>

        <listitem>
          <para>The name of the distribution filename, not including the
          extract suffix (see below).</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${name}-${version}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>distname            ${name}</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>distfiles</term>

        <listitem>
          <para>The full distribution filename, including the extract suffix.
          Used to specify non-default distribution filenames; this keyword
          must be specified (and tags used) when a port has multiple download
          files (see master_sites).</para>

          <itemizedlist>
            <listitem>
              <para>Default:
              <varname>${distname}${extract.suffix}</varname></para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>distfiles           ${name}-dev_src.tgz</programlisting>

              <programlisting>distfiles           file_one.tar.gz:tagone \
                    file_two.tar.gz:tagtwo</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>dist_subdir</term>

        <listitem>
          <para>
            The last path component of <varname>${distpath}</varname>.  Override
            it to store multiple ports' distfiles in the same directory (such as
            multiple ports providing different versions of the same software),
            or if a <link
            xlink:href="https://trac.macports.org/wiki/PortfileRecipes#stealth-updates">stealth
            update</link> has occurred.
          </para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${name}</varname></para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>dist_subdir         gcc</programlisting>

              <programlisting>dist_subdir         ${name}/${version}_1</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>worksrcdir</term>

        <listitem>
          <para>Sets the path to source directory relative to workpath. It can
          be used if the extracted source directory has a different name then
          the distfile. Also used if the source to be built is in a
          subdirectory.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${distname}</varname></para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>worksrcdir          ${name}-src-${version}</programlisting>
              <programlisting>worksrcdir          ${distname}/src</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>

    <section xml:id="reference.phases.fetch.advanced">
      <title>Advanced Fetch Options</title>

      <para>Some mirrors require special options for a resource to be properly
      fetched.</para>

      <variablelist>
        <varlistentry xml:id="reference.phases.fetch.advanced.fetch-type">
          <term>fetch.type</term>

          <listitem>
            <para>Change the fetch type. This is only necessary if a <link
            linkend="reference.phases.fetch.bzr">bzr</link>, <link
            linkend="reference.phases.fetch.cvs">cvs</link>, <link
            linkend="reference.phases.fetch.git">git</link>, <link
            linkend="reference.phases.fetch.hg">hg</link>, or <link
            linkend="reference.phases.fetch.svn">svn</link> checkout is being used.
            <option>standard</option> is used for a normal http or ftp fetch
            using <varname>${distfiles}</varname> and is used as
            default.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <option>standard</option></para>
              </listitem>

              <listitem>
                <para>Values: <option>standard</option> <option>bzr</option>
                <option>cvs</option> <option>git</option>
                <option>hg</option> <option>svn</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>fetch.type          svn
svn.url             svn://example.org
svn.revision        2100</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>fetch.user</term>

          <listitem>
            <para>HTTP or FTP user to fetch the resource.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>fetch.password</term>

          <listitem>
            <para>HTTP or FTP password to fetch the resource.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>fetch.use_epsv</term>

          <listitem>
            <para>Whether to use EPSV command for FTP transfers.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <option>yes</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>fetch.use_epsv      no</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>fetch.ignore_sslcert</term>

          <listitem>
            <para>Whether to ignore the host SSL certificate (for
            HTTPS).</para>

            <itemizedlist>
              <listitem>
                <para>Default: <option>no</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>fetch.ignore_sslcert    yes</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section xml:id="reference.phases.fetch.bzr">
      <title>Fetch from BZR</title>

      <para><link xlink:href="https://bazaar.canonical.com/en/">Bzr</link> may be used as
      an alternative method of fetching distribution files using the keywords
      in this section. However, fetching via bzr may cause non-reproducible
      builds, so it is strongly discouraged.</para>

      <para>The <option>bzr</option> <link
      linkend="reference.phases.fetch.advanced.fetch-type">fetch.type</link>
      is used to fetch source code from a bzr repository.</para>

      <variablelist>
        <varlistentry>
          <term>bzr.url</term>

          <listitem>
            <para>This specifies the url from which to fetch files.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Examples:</para>

                <programlisting>bzr.url             lp:inkscape</programlisting>

                <programlisting>bzr.url             lp:~callelejdfors/pycg/trunk</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>bzr.revision</term>

          <listitem>
            <para>Optional tag for fetching with bzr, this specifies
            the revision to checkout</para>

            <itemizedlist>
              <listitem>
                <para>Default: -1 (the last committed revision)</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>bzr.revision          2209</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section xml:id="reference.phases.fetch.cvs">
      <title>Fetch from CVS</title>

      <para><link xlink:href="http://www.nongnu.org/cvs/">CVS</link> may be used as
      an alternative method of fetching distribution files using the keywords
      in this section. However, fetching via CVS may cause non-reproducible
      builds, so it is strongly discouraged.</para>

      <para>The <option>cvs</option> <link
      linkend="reference.phases.fetch.advanced.fetch-type">fetch.type</link>
      is used to fetch source code from a CVS repository.</para>

      <variablelist>
        <varlistentry>
          <term>cvs.root</term>

          <listitem>
            <para>Specify the url from which to fetch files.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>cvs.root            :pserver:anonymous@cvs.sv.gnu.org:/sources/emacs</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>cvs.password</term>

          <listitem>
            <para>Password to login to the CVS server.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>cvs.password        nice-password</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>cvs.tag</term>

          <listitem>
            <para>Optional for fetching with CVS, this specifies the code
            revision to checkout.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>cvs.tag             HEAD</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>cvs.date</term>

          <listitem>
            <para>A date that identifies the CVS code set to checkout.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>cvs.date            "12-April-2007"</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>cvs.module</term>

          <listitem>
            <para>A CVS module from which to check out the code.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>cvs.module          Sources</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>


    <section xml:id="reference.phases.fetch.git">
      <title>Fetch from Git</title>

      <para><link xlink:href="https://git-scm.com/">Git</link> may be used as an
      alternative method of fetching distribution files using the keywords in
      this section. However, fetching via Git may cause non-reproducible
      builds, so it is strongly discouraged.</para>

      <para>The <option>git</option> <link
      linkend="reference.phases.fetch.advanced.fetch-type">fetch.type</link>
      is used to fetch source code from a git repository.</para>

      <variablelist>
        <varlistentry>
          <term>git.url</term>

          <listitem>
            <para>This specifies the url from which to fetch files.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Examples:</para>

                <programlisting>git.url             git://git.kernel.org/pub/scm/git/git.git</programlisting>

                <programlisting>git.url             https://www.kernel.org/pub/scm/git/git.git</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>git.branch</term>

          <listitem>
            <para>Optional tag for fetching with git, this specifies the tag
            or other commit-ish that git should checkout. Note that any tag on
            a branch besides HEAD should be prefixed by origin/.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>git.branch             72bf1c8</programlisting>

                <programlisting>git.branch             origin/next</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section xml:id="reference.phases.fetch.hg">
      <title>Fetch from Mercurial</title>

      <para><link xlink:href="https://mercurial.selenic.com/">Mercurial</link> may be
      used as an alternative method of fetching distribution files using the
      keywords in this section. However, fetching via Mercurial may cause
      non-reproducible builds, so it is strongly discouraged.</para>

      <para>The <option>hg</option> <link
      linkend="reference.phases.fetch.advanced.fetch-type">fetch.type</link>
      is used to fetch source code from a Mercurial repository.</para>

      <variablelist>
        <varlistentry>
          <term>hg.url</term>

          <listitem>
            <para>This specifies the url from which to fetch files.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Examples:</para>

                <programlisting>hg.url              https://www.kernel.org/hg/index.cgi/linux-2.6/</programlisting>

                <programlisting>hg.url              http://hg.intevation.org/mercurial</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>hg.tag</term>

          <listitem>
            <para>Optional tag which should be fetched. Can be a Mercurial tag
            or a revision. To prevent non-reproducible builds use of tip as
            revision is discouraged.</para>

            <itemizedlist>
              <listitem>
                <para>Default: tip</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>hg.tag              v1.3</programlisting>

                <programlisting>hg.tag              ceb884843737</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section xml:id="reference.phases.fetch.svn">
      <title>Fetch from Subversion</title>

      <para><link xlink:href="https://subversion.apache.org/">Subversion</link> may
      be used as an alternative method of fetching distribution files using
      the keywords in this section. However, fetching via Subversion may cause
      non-reproducible builds, so it is strongly discouraged.</para>

      <para>The <option>svn</option> <link
      linkend="reference.phases.fetch.advanced.fetch-type">fetch.type</link>
      is used to fetch source code from an svn repository.</para>

      <variablelist>
        <varlistentry>
          <term>svn.url</term>

          <listitem>
            <para>This specifies the url from which to fetch files.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Examples:</para>

                <programlisting>svn.url             https://www.example.com/svn-repo/mydirectory</programlisting>

                <programlisting>svn.url             svn://svn.example.com/svn-repo/mydirectory</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>svn.revision</term>

          <listitem>
            <para>Optional tag for fetching with Subversion, this specifies
            the peg revision to checkout; it corresponds to the @REV syntax of
            the svn cli.</para>

            <itemizedlist>
              <listitem>
                <para>Default: none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>svn.revision        37192</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>svn.method</term>

          <listitem>
            <para>Optional tag for fetching with Subversion, this specifies
            whether to check out the code into a working copy, or just export
            it without the working copy metadata. An export is preferable
            because it takes half the disk space, but some software expects
            to be built in a working copy (for example because it wants to
            record the revision number into itself somewhere).</para>

            <itemizedlist>
              <listitem>
                <para>Default: export</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>svn.method          checkout</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section xml:id="reference.phases.checksum">
    <title>Checksum Phase Keywords</title>

    <para>The list of keywords related to the checksum phase.</para>

    <variablelist>
      <varlistentry>
        <term>checksums</term>

        <listitem>
          <para>Checksum(s) of the distribution files. For ports with multiple
          distribution files, filenames must be included to associate files
          with their checksums.  Each checksum entry should also indicate the
          file's size.</para>

          <para>At least two checksum types (typically rmd160 and sha256) should be used to
          ensure the integrity of the distfiles.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>checksums           rmd160  0c1147242adf476f5e93f4d59b553ee3ea378b23 \
                    sha256  baf8a29ff721178317aac7b864c2d392b1accc02de8677dd24c18fd5717bf26e \
                    size    1039840</programlisting>

              <programlisting>checksums           ${distname}${extract.suffix} \
                        rmd160  0c1147242adf476f5e93f4d59b553ee3ea378b23 \
                        sha256  883715307c31ae2c145db15d2404d89a837f4d03d7e6932aed21d1d1f21dad89 \
                        size    2429530 \
                    hobbit.tar.gz \
                        rmd160  82b9991f3bf0ceedbf74c188c5fa44b98b5e40c9 \
                        sha256  2c3afd16915e9f8eac2351673f8b599f5fd2ff9064d4dfe61f750d72bab740b3 \
                        size    8594032</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section xml:id="reference.phases.extract">
    <title>Extract Phase Keywords</title>

    <para>The list of keywords related to the extract phase.</para>

    <variablelist>
      <varlistentry>
        <term>extract.asroot</term>

        <listitem>
          <para>This keyword is used to specify that the extract
          phase should be done as the root user.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.asroot      no</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>extract.suffix</term>

        <listitem>
          <para>This keyword is used to specify the extract suffix
          type.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <filename>.tar.gz</filename></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.suffix      .tgz</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_7z</term>

        <listitem>
          <para>This keyword is for downloads that are compressed using the
          7z algorithm.  When invoked, it automatically sets:</para>

          <literallayout>extract.suffix = .7z
extract.cmd    = 7za

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_7z           yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_bzip2</term>

        <listitem>
          <para>This keyword is for downloads that are tarred and bzipped.
          When invoked, it automatically sets:</para>

          <literallayout>extract.suffix = .tar.bz2
extract.cmd    = bzip

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_bzip2           yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_lzma</term>

        <listitem>
          <para>This keyword is for downloads that are compressed using the
          lzma algorithm. When invoked, it automatically sets:</para>

          <literallayout>extract.suffix    = .lzma
extract.cmd       = lzma

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_lzma             yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_tar</term>

        <listitem>
            <para>This keyword is for downloads that are uncompressed tar
            archives. When invoked, it automatically sets:</para>

          <literallayout>extract.suffix    = .tar
extract.cmd       = tar
extract.pre_args  = -xf

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_tar             yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_zip</term>

        <listitem>
          <para>This keyword is for downloads that are zipped. When invoked,
          it automatically sets:</para>

          <literallayout>extract.suffix    = .zip
extract.cmd       = unzip
extract.pre_args  = -q
extract.post_args = "-d ${extract.dir}"

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_zip             yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_xz</term>

        <listitem>
          <para>This keyword is for downloads that are compressed using the xz tool.
          When invoked, it automatically sets:</para>

          <literallayout>extract.suffix    = .tar.xz
extract.cmd       = xz

</literallayout>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_xz             yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>


      <varlistentry>
        <term>extract.mkdir</term>

        <listitem>
          <para>This keyword is used to specify if the directory
          <filename>worksrcdir</filename> is part of the distfile or if it
          should be created automatically and the distfiles should be
          extracted there instead. This is useful for distfiles with a flat
          structure which would pollute the <filename>worksrcdir</filename>
          with lots of files.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.mkdir       yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>extract.only</term>

        <term>extract.only-append</term>

        <term>extract.only-delete</term>

        <listitem>
          <para>List of files to extract into
          <varname>${worksrcpath}</varname>. Only use if default extract
          behavior is not correct for your port.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${distfiles}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.only        foo.tar.gz</programlisting>

              <programlisting>extract.only-append     bar.tar.gz
extract.only-delete     foo.tar.gz</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>extract.cmd</term>

        <listitem>
          <para>Command to perform extraction.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <command>gzip</command></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.cmd         gunzip</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>extract.args</term>

        <term>extract.pre_args</term>

        <term>extract.post_args</term>

        <listitem>
          <para>Main arguments to <varname>extract.cmd</varname>; additional
          arguments passed before and after the main arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${distpath}/${distfile}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>extract.args        ${distpath}/${distfile}

</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>extract.pre_args</literal>, defaults to:
              <literal>-dc</literal></para>
            </listitem>

            <listitem>
              <para><literal>extract.post_args</literal>, defaults to:
              <literal>"| tar -xf -"</literal></para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>extract.pre_args    xf
extract.post_args   "| gnutar -x"</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section xml:id="reference.phases.patch">
    <title>Patch Phase Keywords</title>

    <para>The list of keywords related to the patch phase.</para>

    <variablelist>
      <varlistentry>
        <term>patch.dir</term>

        <listitem>
          <para>Specify the base path for patch files.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${worksrcpath}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patch.dir           ${worksrcpath}/util</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patch.cmd</term>

        <listitem>
          <para>Specify the command to be used for patching files.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <command>patch</command></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patch.cmd           cat</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patchfiles</term>

        <term>patchfiles-append</term>

        <term>patchfiles-delete</term>

        <listitem>
          <para>Specify patch files to be applied for a port; list modifiers
          specify patchfiles to be added or removed from a previous patchfile
          declaration.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patchfiles          patch-destdir-variable-fix.diff \
                    patch-source.c.diff</programlisting>

              <programlisting>patchfiles-append   patch-configure.diff
patchfiles-delete   patch-destdir-variable-fix.diff</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>patch.args</term>

        <term>patch.pre_args</term>

        <term>patch.post_args</term>

        <listitem>
          <para>Main arguments to <varname>patch.cmd</varname>; optional
          argument modifiers pass arguments before and after the main
          arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>patch.args          ???

</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>patch.pre_args</literal>, defaults to:
              <literal>-p0</literal></para>
            </listitem>

            <listitem>
              <para><literal>patch.post_args</literal>, defaults to:
              none</para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>patch.pre_args      -p1
patch.post_args     ???</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section xml:id="reference.phases.configure">
    <title>Configure Phase Keywords</title>

    <para>The list of keywords related to the configure phase.</para>

    <para>MacPorts base sets some important default configure options, so
    should use the -append version of most configure keywords so you don't
    overwrite them. For example, MacPorts base sets default
    <literal>configure.cflags</literal> so you should always use
    <literal>configure.cflags-append</literal> to set additional CFLAGS in
    Portfiles.</para>

    <variablelist>
      <varlistentry>
        <term>use_configure</term>

        <listitem>
          <para>Sets if the configure phase should be run. Can be used if the
          port has no <filename>./configure</filename> script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>yes</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_configure    no</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

    <varlistentry>
        <term>configure.cmd</term>

        <term>configure.cmd-append</term>

        <term>configure.cmd-delete</term>

        <listitem>
          <para>Selects the command to be run in the default configure phase.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>./configure</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cmd       ./config.sh</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.env</term>

        <term>configure.env-append</term>

        <term>configure.env-delete</term>

        <listitem>
          <para>Set environment variables for configure; list modifiers add
          and delete items from a previous Portfile configure.env keyword, or
          a default set by MacPorts base. If available, it is encouraged to
          use the predefined options (like <link
          linkend="reference.phases.configure.cflags">configure.cflags</link>)
          instead of modifying configure.env directly.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>CFLAGS=-I${prefix}/include
              LDFLAGS=-L${prefix}/lib</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.env       QTDIR=${prefix}/lib/qt3</programlisting>

              <programlisting>configure.env-append    ABI=32
configure.env-delete    TCLROOT=${prefix}</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry xml:id="reference.phases.configure.optflags">
        <term>configure.optflags</term>

        <term>configure.optflags-append</term>

        <term>configure.optflags-delete</term>

        <listitem>
          <para>Set optimization compiler flags; list modifiers add or delete items
          from a previous Portfile configure.optflags keyword or the default set
          by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>-Os</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.optflags    -O2</programlisting>

              <programlisting>configure.optflags-append     -finline-functions
configure.optflags-delete     -Os</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry xml:id="reference.phases.configure.cflags">
        <term>configure.cflags</term>

        <term>configure.cflags-append</term>

        <term>configure.cflags-delete</term>

        <listitem>
          <para>Set CFLAGS compiler flags; list modifiers add or delete items
          from a previous Portfile configure.cflags keyword or the default set
          by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cflags    -Os -flat_namespace</programlisting>

              <programlisting>configure.cflags-append     "-undefined suppress"
configure.cflags-delete     -O2</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.ldflags</term>

        <term>configure.ldflags-append</term>

        <term>configure.ldflags-delete</term>

        <listitem>
          <para>Set LDFLAGS compiler flags; list modifiers add or delete items
          from a previous Portfile configure.ldflags keyword or the default
          set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>-L${prefix}/lib -Wl,-headerpad_max_install_names</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.ldflags   "-L${worksrcpath}/zlib -lz"</programlisting>

              <programlisting>configure.ldflags-append    "-L/usr/X11R6/lib -L${worksrcpath}/lib"
configure.ldflags-delete    -L${prefix}/lib/db44</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.cppflags</term>

        <term>configure.cppflags-append</term>

        <term>configure.cppflags-delete</term>

        <listitem>
          <para>Set CPPFLAGS to be passed to the C processor; list modifiers
          add or delete items from a previous Portfile configure.cppflags
          keyword or the default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>-I${prefix}/include</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cppflags  -I${worksrcpath}/include</programlisting>

              <programlisting>configure.cppflags-append   "-I/usr/X11R6/lib -I${worksrcpath}/lib -DHAVE_RRD_12X"
configure.cppflags-delete   -I${prefix}/lib/db44</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.cxxflags</term>

        <term>configure.cxxflags-append</term>

        <term>configure.cxxflags-delete</term>

        <listitem>
          <para>Set CXXFLAGS to be passed to the C++ processor; list modifiers
          add or delete items from a previous Portfile configure.cxxflags
          keyword or the default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>TODO: add example</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.objcflags</term>

        <term>configure.objcflags-append</term>

        <term>configure.objcflags-delete</term>

        <listitem>
          <para>TODO: add description</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>TODO: add example</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.classpath</term>

        <term>configure.classpath-append</term>

        <term>configure.classpath-delete</term>

        <listitem>
          <para>TODO: add description</para>

          <itemizedlist>
            <listitem>
              <para>Default: ???</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>TODO: add example</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.macosx_deployment_target</term>

        <term>configure.macosx_deployment_target-append</term>

        <term>configure.macosx_deployment_target-delete</term>

        <listitem>
          <para>TODO: add description</para>

          <itemizedlist>
            <listitem>
              <para>Default: ???</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>TODO: add example</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <!-- fortran compiler options -->

      <varlistentry>
        <term>configure.fflags</term>

        <term>configure.fflags-append</term>

        <term>configure.fflags-delete</term>

        <listitem>
          <para>Set FFLAGS to be passed to the Fortran compiler; list
          modifiers add or delete items from a previous Portfile
          configure.fflags keyword or the default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.fflags    -Os</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.fcflags</term>

        <term>configure.fcflags-append</term>

        <term>configure.fcflags-delete</term>

        <listitem>
          <para>Set FCFLAGS to be passed to the Fortran compiler; list
          modifiers add or delete items from a previous Portfile
          configure.fcflags keyword or the default set by MacPorts
          base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.fcflags   -Os</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.f90flags</term>

        <term>configure.f90flags-append</term>

        <term>configure.f90flags-delete</term>

        <listitem>
          <para>Set F90FLAGS to be passed to the Fortran 90 compiler; list
          modifiers add or delete items from a previous Portfile
          configure.f90flags keyword or the default set by MacPorts
          base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${configure.optflags}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.f90flags  -Os</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <!-- fortran compiler options end -->

      <!-- compiler selection arguments -->

      <varlistentry>
        <term>configure.cc</term>

        <listitem>
          <para>C compiler for the CC environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cc        ${prefix}/bin/gcc-mp-4.2</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.cpp</term>

        <listitem>
          <para>C preprocessor for the CPP environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cpp       /usr/bin/cpp-3.3</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.cxx</term>

        <listitem>
          <para>C++ compiler for the CXX environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.cxx       /usr/bin/g++-4.0</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.objc</term>

        <listitem>
          <para>Objective-C compiler for the OBJC environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.objc      /usr/bin/gcc-4.0</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.fc</term>

        <listitem>
          <para>Fortran compiler for the FC environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.fc        ${prefix}/bin/gfortran-mp-4.2</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.f77</term>

        <listitem>
          <para>Fortran 77 compiler for the F77 environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.f77       ${prefix}/bin/gfortran-mp-4.2</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.f90</term>

        <listitem>
          <para>Fortran 90 compiler for the F90 environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.f90       ${prefix}/bin/gfortran-mp-4.2</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.javac</term>

        <listitem>
          <para>Java compiler for the JAVAC environment variable when invoking the configure script.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.javac     ${prefix}/bin/jikes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.compiler</term>

        <listitem>
          <para>Select a compiler suite to fill the compiler environment
          variables. All variables/tools a compiler suite can provide are set.
          Manually set variables are not overwritten.
          Keep in mind that not all compiler suites might be available on your
          platform: <option>gcc-3.3</option> is available on Mac OS X 10.3 and
          10.4 PowerPC, <option>gcc-4.0</option> is available on 10.4 and 10.5,
          <option>gcc-4.2</option> and <option>llvm-gcc-4.2</option> are
          available on 10.5 and 10.6, and <option>clang</option> is available
          on 10.6 and later.</para>

          <para>Only use it if a port really needs a different
          compiler.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>apple-gcc-4.2</option> on Mac OS X 10.4</para>
            </listitem>

            <listitem>
              <para>Default: <option>gcc-4.2</option> with Xcode 3.x on Mac OS X 10.5 and 10.6</para>
            </listitem>

            <listitem>
              <para>Default: <option>llvm-gcc-4.2</option> with Xcode 4.0 through 4.2 on Mac OS X 10.6 and 10.7</para>
            </listitem>

            <listitem>
              <para>Default: <option>clang</option> with Xcode 4.3 and later on OS X 10.7 and later</para>
            </listitem>

            <listitem>
              <para>Values: <option>gcc-3.3</option> <option>gcc-4.0</option>
              <option>gcc-4.2</option> <option>llvm-gcc-4.2</option>
              <option>clang</option>
              <option>macports-clang-3.3</option>
              <option>macports-clang-3.4</option>
              <option>macports-clang-3.7</option>
              <option>macports-clang-3.8</option>
              <option>macports-clang-3.9</option>
              <option>macports-clang-4.0</option>
              <option>macports-clang-5.0</option>
              <option>macports-clang-6.0</option>
              <option>apple-gcc-4.0</option>
              <option>apple-gcc-4.2</option>
              <option>macports-gcc-4.3</option>
              <option>macports-gcc-4.4</option>
              <option>macports-gcc-4.5</option>
              <option>macports-gcc-4.6</option>
              <option>macports-gcc-4.7</option>
              <option>macports-gcc-4.8</option>
              <option>macports-gcc-4.9</option>
              <option>macports-gcc-5</option>
              <option>macports-gcc-6</option>
              <option>macports-gcc-7</option>
              <option>macports-gcc-8</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.compiler  macports-gcc-4.5</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <!-- compiler selection arguments end -->

      <!-- interpreter selection arguments -->

      <varlistentry>
        <term>configure.perl</term>

        <listitem>
          <para>Set PERL flag for selecting a Perl interpreter.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.perl      ${prefix}/bin/perl5.26</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.python</term>

        <listitem>
          <para>Set PYTHON flag for selecting a Python interpreter.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.python    ${prefix}/bin/python2.7</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.ruby</term>

        <listitem>
          <para>Set RUBY flag for selecting a Ruby interpreter.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.ruby      ${prefix}/bin/ruby</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <!-- interpreter selection arguments end -->

      <!-- other tools selection arguments -->

      <varlistentry>
        <term>configure.install</term>

        <listitem>
          <para>Set <literal>INSTALL</literal> flag for selecting an install
          tool; used for copying files and creating directories.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <filename>/usr/bin/install</filename></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.install   ${prefix}/bin/ginstall</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.awk</term>

        <listitem>
          <para>Set AWK flag for selecting an awk executable.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.awk       ${prefix}/bin/gawk</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.bison</term>

        <listitem>
          <para>Set BISON flag for selecting a bison executable, a parser
          generator.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.bison     /usr/bin/bison</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.pkg_config</term>

        <listitem>
          <para>Set PKG_CONFIG flag for helping find pkg_config, a tool for
          retrieving information about installed libraries.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>???</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.pkg_config    ${prefix}/bin/pkg-config</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>configure.pkg_config_path</term>

        <listitem>
          <para>Set PKG_CONFIG_PATH flag for telling pkg_config where to
          search for information about installed libraries.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>${prefix}/lib/pkgconfig:${prefix}/share/pkgconfig</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.pkg_config_path   ${python.prefix}/lib/pkgconfig</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <!-- other tools selection arguments end -->

      <varlistentry>
        <term>configure.args</term>

        <term>configure.pre_args</term>

        <term>configure.post_args</term>

        <listitem>
          <para>Main arguments to <literal>configure.cmd</literal>; optional
          argument modifiers pass arguments before and after the main
          arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>configure.args      --bindir=${prefix}/bin

</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>configure.pre_args</literal>, defaults to:
              <literal>--prefix=${prefix}</literal></para>
            </listitem>

            <listitem>
              <para><literal>configure.post_args</literal>, defaults to:
              none</para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>configure.pre_args  --prefix=${prefix}/share/bro
configure.post_args OPT="-D__DARWIN_UNIX03"</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>

    <section xml:id="reference.phases.configure.universal">
      <title>Configure Universal</title>

      <para>Universal keywords are used to make a port compile on OS X for
      multiple architectures.</para>

      <note>
        <para>There is a default universal variant made available to all ports
        by MacPorts base, so redefining universal keywords should only be done
        to make a given port compile if the default options fail to do
        so.</para>
      </note>

      <variablelist>
        <varlistentry>
          <term>configure.universal_args</term>

          <listitem>
            <para>Arguments used in the configure script to build the port
            universal.</para>

            <itemizedlist>
              <listitem>
                <para>Default:
                <literal>--disable-dependency-tracking</literal></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>configure.universal_cflags</term>

          <listitem>
            <para>Additional flags to put in the CFLAGS environment variable
            when invoking the configure script. Default value is based on
            <literal>${configure.universal_archs}</literal>.</para>

            <itemizedlist>
              <listitem>
                <para>Default: </para>
                <para>(PowerPC Tiger) <literal>-isysroot ${developer_dir}/SDKs/MacOSX10.4u.sdk -arch i386 -arch ppc</literal></para>
                <para>(Intel Tiger / Leopard) <literal>-arch i386 -arch ppc</literal></para>
                <para>(Snow Leopard and later) <literal>-arch x86_64 -arch i386</literal></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>configure.universal_cppflags</term>

          <listitem>
            <para>Additional flags to put in the CPPFLAGS environment variable
            when invoking the configure script.</para>

            <itemizedlist>
              <listitem>
                <para>Default: </para>
                <para>(PowerPC Tiger) <literal>-isysroot ${developer_dir}/SDKs/MacOSX10.4u.sdk</literal></para>
                <para>(others) none</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>configure.universal_cxxflags</term>

          <listitem>
            <para>Additional flags to put in the CXXFLAGS environment variable
            when invoking the configure script. Default value is based on
            <literal>${configure.universal_archs}</literal>.</para>

            <itemizedlist>
              <listitem>
                <para>Default: </para>
                <para>(PowerPC Tiger) <literal>-isysroot ${developer_dir}/SDKs/MacOSX10.4u.sdk -arch i386 -arch ppc</literal></para>
                <para>(Intel Tiger / Leopard) <literal>-arch i386 -arch ppc</literal></para>
                <para>(Snow Leopard and later) <literal>-arch x86_64 -arch i386</literal></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>configure.universal_ldflags</term>

          <listitem>
            <para>Additional flags to put in the LDFLAGS environment variable
            when invoking the configure script.</para>

            <itemizedlist>
              <listitem>
                <para>Default: </para>
                <para>(PowerPC Tiger) <literal>-Wl,-syslibroot,${developer_dir}/SDKs/MacOSX10.4u.sdk -arch i386 -arch ppc</literal></para>
                <para>(Intel Tiger / Leopard) <literal>-arch i386 -arch ppc</literal></para>
                <para>(Snow Leopard and later) <literal>-arch x86_64 -arch i386</literal></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>TODO: add example</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section xml:id="reference.phases.configure.automake-autoconf">
      <title>Automake, Autoconf, and Autoreconf</title>

      <para>The list of configure keywords available for ports that need
      automake and/or autoconf.</para>

      <variablelist>
        <varlistentry>
          <term>use_autoreconf</term>
          <listitem>
            <para>Whether or not to use autoreconf</para>
            <itemizedlist>
              <listitem>
                <para>Default: <option>no</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>use_autoreconf      yes</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>use_automake</term>

          <listitem>
            <para>Whether or not to use automake.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <option>no</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>use_automake        yes</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>automake.env</term>

          <listitem>
            <para>Environment variables to pass to automake.</para>

            <itemizedlist>
              <listitem>
                <para>Default: ???</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>automake.env        CFLAGS=-I${prefix}/include</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>automake.args</term>

          <listitem>
            <para>Arguments to pass to automake.</para>

            <itemizedlist>
              <listitem>
                <para>Default: ???</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>automake.args       --foreign</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>automake.dir</term>

          <listitem>
            <para>Directory in which to run
            <varname>${automake.cmd}</varname>.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <varname>${worksrcpath}</varname></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>automake.dir        ./src</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>use_autoconf</term>

          <listitem>
            <para>Whether or not to use autoconf.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <option>no</option></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>use_autoconf        yes</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>autoconf.env</term>

          <listitem>
            <para>Environmental variables to pass to autoconf.</para>

            <itemizedlist>
              <listitem>
                <para>Default: ???</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>autoconf.env        CFLAGS=-I${prefix}/include/gtk12</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>autoconf.args</term>

          <listitem>
            <para>Arguments to pass to autoconf.</para>

            <itemizedlist>
              <listitem>
                <para>Default: ???</para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>autoconf.args       "-l src/aclocaldir"</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>autoconf.dir</term>

          <listitem>
            <para>Directory in which to run
            <varname>${autoconf.cmd}</varname>.</para>

            <itemizedlist>
              <listitem>
                <para>Default: <varname>${worksrcpath}</varname></para>
              </listitem>

              <listitem>
                <para>Example:</para>

                <programlisting>autoconf.dir        src</programlisting>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section xml:id="reference.phases.build">
    <title>Build Phase Keywords</title>

    <para>The list of keywords related to the build phase.</para>

    <variablelist>
      <varlistentry>
        <term>build.cmd</term>

        <listitem>
          <para>Make command to run in <varname>${worksrcdir}</varname>. Only
          use it if you can't use <literal>build.type</literal>.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <command>make</command></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>build.cmd           scons</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build.type</term>

        <listitem>
          <para>
            Defines which build software is required and sets
            <varname>${build.cmd}</varname> accordingly. The available
            options are BSD Make, GNU Make, and Xcode.
          </para>

          <itemizedlist>
            <listitem>
              <para>
                Default: <option>default</option> (the default Make on
                the current platform)
              </para>
            </listitem>

            <listitem>
              <para>
                Values: <option>default</option>
                        <option>bsd</option>
                        <option>gnu</option>
                        <option>xcode</option>
              </para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>build.type          bsd</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build.args</term>

        <term>build.pre_args</term>

        <term>build.post_args</term>

        <listitem>
          <para>Main arguments to <varname>${build.cmd}</varname>; optional
          argument modifiers pass arguments before and after the main
          arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>build.args          -DNOWARN

</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>build.pre_args</literal>, defaults to:
              <varname>${build.target}</varname></para>
            </listitem>

            <listitem>
              <para><literal>build.post_args</literal>, defaults to:
              none</para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>build.pre_args      -project AudioSlicer.xcode
build.post_args     CFLAGS_SYS="-DUSE_FREETYPE -DPREFER_FREETYPE"</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build.target</term>

        <term>build.target-append</term>

        <term>build.target-delete</term>

        <listitem>
          <para>Build target to pass to <varname>${build.cmd}</varname>; list
          modifiers add or delete items from a previous Portfile build.target
          keyword or the default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>all</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>build.target        all-src</programlisting>

              <programlisting>build.target-append     doc extra
build.target-delete     compat</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build.env</term>

        <term>build.env-append</term>

        <term>build.env-delete</term>

        <listitem>
          <para>Set environment variables for build; list modifiers add
          and delete items from a previous Portfile build.env keyword, or
          a default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>use_parallel_build</term>

        <listitem>
          <para>This keyword is for specifying whether or not it is safe for a
          port to use multiple CPUs or multiple cores in parallel during its
          build phase. If <code>use_parallel_build</code> is not set to
          <quote>no</quote> in a given port, the option <option>-j${build.jobs}</option>
          is passed to <varname>${build.cmd}</varname> (if
          <varname>${build.cmd}</varname> is <command>make</command> or
          <command>scons</command>).</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>yes</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>use_parallel_build  no</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>build.jobs</term>

        <listitem>
          <para>The number of simultaneous jobs to run when parallel build is
          enabled. The default value is based on the variable
          <varname>buildmakejobs</varname> in
          <filename>macports.conf</filename>.</para>

          <itemizedlist>
            <listitem>
              <para>Default: If <varname>buildmakejobs</varname> is 0, the
              number of CPU cores in the machine, or the number of GB of
              physical memory plus one, whichever is less. Otherwise, 
              the actual value of <literal>${buildmakejobs}</literal>.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

    </variablelist>
  </section>

  <section xml:id="reference.phases.test">
    <title>Test Phase Keywords</title>

    <para>The list of keywords related to the test phase.</para>

    <variablelist>
      <varlistentry>
        <term>test.run</term>

        <listitem>
          <para>Enable running test suites bundled with a port.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>test.run            yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>test.cmd</term>

        <listitem>
          <para>Test command to run relative to
          <varname>${worksrcdir}</varname>.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${build.cmd}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>test.cmd            checks.sh</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>test.target</term>

        <listitem>
          <para>Test target to pass to <varname>${test.cmd}</varname>.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>test</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>test.target         checks</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>test.args</term>

        <term>test.pre_args</term>

        <term>test.post_args</term>

        <listitem>
          <para>Main arguments to <varname>test.cmd</varname>; optional
          argument modifiers pass arguments before and after the main
          arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>test.args    -f Makefile.test</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>test.pre_args</literal>, defaults to:
              <literal>${test.target}</literal></para>
            </listitem>

            <listitem>
              <para><literal>test.post_args</literal>, defaults to:
              none</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>test.env</term>

        <term>test.env-append</term>

        <term>test.env-delete</term>

        <listitem>
          <para>Set environment variables for test; list modifiers add
          and delete items from a previous Portfile test.env keyword, or
          a default set by MacPorts base.</para>

          <para>Often <literal>DYLD_LIBRARY_PATH</literal> is set here to
          support testing dynamically linked libraries.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>test.env       <literal>DYLD_LIBRARY_PATH=${worksrcpath}/src/.libs</literal></programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>

  <section xml:id="reference.phases.destroot">
    <title>Destroot Phase Keywords</title>

    <para>The list of keywords related to the destroot phase.</para>

    <variablelist>
      <varlistentry>
        <term>destroot.cmd</term>

        <listitem>
          <para>Install command to run relative to
          <varname>${worksrcdir}</varname>.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <varname>${build.cmd}</varname></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.cmd        scons</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.args</term>

        <term>destroot.pre_args</term>

        <term>destroot.post_args</term>

        <listitem>
          <para>Main arguments to <varname>${destroot.cmd}</varname>; optional
          argument modifiers pass arguments before and after the main
          arguments.</para>

          <itemizedlist>
            <listitem>
              <para>Default: none</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.args       BINDIR=${prefix}/bin

</programlisting>
            </listitem>
          </itemizedlist>

          <para>The following argument modifiers are available:</para>

          <itemizedlist>
            <listitem>
              <para><literal>destroot.pre_args</literal>, defaults to:
              <varname>${destroot.target}</varname></para>
            </listitem>

            <listitem>
              <para><literal>destroot.post_args</literal>, defaults to:
                <varname>${destroot.destdir}</varname></para>
            </listitem>

            <listitem>
              <para>Examples:</para>

              <programlisting>destroot.pre_args   -project AudioSlicer.xcode
destroot.post_args  INSTDIR=${destroot}${prefix}</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.target</term>

        <term>destroot.target-append</term>

        <term>destroot.target-delete</term>

        <listitem>
          <para>Install target to pass to <varname>${destroot.cmd}</varname>;
          list modifiers add or delete items from a previous Portfile
          destroot.target keyword or the default set by MacPorts base.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>install</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.target     install install-config install-commandmode</programlisting>

              <programlisting>destroot.target-append  install-plugins
destroot.target-delete  install-commandmode</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.destdir</term>

        <listitem>
          <para>Arguments passed to <varname>${destroot.cmd}</varname> via
            <varname>${destroot.post_args}</varname> to install correctly
            into the destroot.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>DESTDIR=${destroot}</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.destdir    prefix=${destroot}${prefix}</programlisting>
            </listitem>
          </itemizedlist>

          <note>
            <para>If an application's Makefile properly supports the DESTDIR
            variable, MacPorts will automatically destroot the port properly.
            A port must destroot properly or the port will not install
            correctly, upgrade, or uninstall. If not, you may need to set this
            variable, or even patch the application's Makefile.</para>
          </note>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.umask</term>

        <listitem>
          <para>Umask to use during destroot.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <literal>022</literal></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.umask      002</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.keepdirs</term>

        <listitem>
          <para>A list of directories that should not be removed if empty upon
          destroot completion.</para>

          <itemizedlist>
            <listitem>
              <para>Default: ???</para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.keepdirs   ${destroot}${prefix}/var/run \
                    ${destroot}${prefix}/var/log \
                    ${destroot}${prefix}/var/cache/mrtg</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>destroot.violate_mtree</term>

        <listitem>
          <para>MacPorts tests for compliance to the common directory
          structure in <varname>${prefix}</varname>. If a port is not
          compliant with the standard, set it to <option>yes</option>.</para>

          <para>You can find the macports standard in <link
          linkend="internals.hierarchy">MacPorts File Hierarchy</link> or in
          the porthier(7) man page.</para>

          <para>If <code>destroot.violate_mtree</code> is set to
          <option>yes</option>, the following warning is issued during the
          installation.</para>

          <screen>Warning: <replaceable>portname</replaceable> requests to install files outside the common directory structure!</screen>

          <para>This means that the port installed files outside of their
          normal locations in <varname>${prefix}</varname>. These could be
          files totally outside of <varname>${prefix}</varname>, which could
          cause problems on your computer, or files inside of
          <varname>${prefix}</varname> that are not in a standard location.
          Use <literal>port contents
          <replaceable>portname</replaceable></literal> to see the location
          for all files that were installed by a given port.</para>

          <itemizedlist>
            <listitem>
              <para>Default: <option>no</option></para>
            </listitem>

            <listitem>
              <para>Example:</para>

              <programlisting>destroot.violate_mtree      yes</programlisting>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
</section>
